<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySocial (Telegram Style)</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --sidebar-bg: #f4f4f5;
            --primary-color: #3390ec; /* Telegram Blue */
            --secondary-bg: #ffffff;
            --border-color: #dfe1e5;
            --message-out: #eeffde;
            --message-in: #ffffff;
            --input-bg: #f4f4f5;
        }

        [data-theme="dark"] {
            --bg-color: #0f0f0f;
            --text-color: #ffffff;
            --sidebar-bg: #1c1c1d;
            --primary-color: #8774e1;
            --secondary-bg: #212121;
            --border-color: #2b2b2b;
            --message-out: #8774e1;
            --message-in: #212121;
            --input-bg: #1c1c1d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- Auth Screen --- */
        #auth-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .auth-box {
            background: var(--secondary-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            width: 300px;
            text-align: center;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-color);
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
        }
        button:hover { opacity: 0.9; }
        .toggle-link {
            color: var(--primary-color);
            cursor: pointer;
            margin-top: 10px;
            display: block;
            font-size: 0.9em;
        }

        /* --- Main Layout --- */
        #app-screen {
            display: none;
            width: 100%;
            height: 100%;
        }
        .sidebar {
            width: 250px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 10px;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-color);
            overflow: hidden;
        }
        
        /* Navigation */
        .nav-item {
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            color: var(--text-color);
        }
        .nav-item:hover, .nav-item.active {
            background-color: rgba(128,128,128, 0.1);
        }
        .nav-item i { margin-right: 10px; }

        /* Views */
        .view {
            display: none;
            padding: 20px;
            overflow-y: auto;
            height: 100%;
        }
        .view.active { display: block; }

        /* Posts */
        .post-card {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            max-width: 600px;
        }
        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--primary-color);
            cursor: pointer;
        }
        .post-content { line-height: 1.5; }
        .post-date { font-size: 0.8em; color: gray; }

        /* Create Post */
        .create-post-box {
            max-width: 600px;
            margin-bottom: 20px;
        }
        textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text-color);
            resize: none;
            box-sizing: border-box;
        }

        /* Profile */
        .profile-header {
            background: var(--secondary-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        .profile-stats {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            font-weight: bold;
        }
        .action-btn { width: auto; padding: 8px 20px; }

        /* Chat */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .message-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 15px;
            position: relative;
        }
        .msg-own {
            align-self: flex-end;
            background: var(--message-out);
            color: var(--text-color);
        }
        [data-theme="dark"] .msg-own { color: white; }
        
        .msg-other {
            align-self: flex-start;
            background: var(--message-in);
            border: 1px solid var(--border-color);
        }
        .chat-input-area {
            padding: 10px;
            background: var(--secondary-bg);
            display: flex;
            gap: 10px;
        }

        /* User List (Friends/Search) */
        .user-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .user-item:hover { background: rgba(0,0,0,0.05); }

        /* Helper Classes */
        .hidden { display: none !important; }
        h2 { margin-top: 0; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-box" id="login-box">
            <h2>–í—Ö–æ–¥</h2>
            <input type="text" id="login-username" placeholder="–Æ–∑–µ—Ä–Ω–µ–π–º">
            <input type="password" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å">
            <button onclick="app.login()">–í–æ–π—Ç–∏</button>
            <span class="toggle-link" onclick="ui.toggleAuth('register')">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –°–æ–∑–¥–∞—Ç—å</span>
        </div>

        <div class="auth-box hidden" id="register-box">
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <input type="text" id="reg-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ —é–∑–µ—Ä–Ω–µ–π–º">
            <input type="password" id="reg-password" placeholder="–ü–∞—Ä–æ–ª—å">
            <button onclick="app.register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <span class="toggle-link" onclick="ui.toggleAuth('login')">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏</span>
        </div>
    </div>

    <div id="app-screen">
        <div class="sidebar">
            <h3 style="padding-left:12px; margin-bottom: 20px;">MySocial</h3>
            <div class="nav-item active" onclick="ui.navigate('feed')">üì∞ –õ–µ–Ω—Ç–∞</div>
            <div class="nav-item" onclick="ui.navigate('profile', app.currentUser)">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
            <div class="nav-item" onclick="ui.navigate('chats')">üí¨ –ß–∞—Ç—ã</div>
            <div class="nav-item" onclick="ui.navigate('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="nav-item" style="margin-top: auto; color: red;" onclick="app.logout()">–í—ã–π—Ç–∏</div>
        </div>

        <div class="main-content">
            
            <div id="view-feed" class="view active">
                <div class="create-post-box">
                    <textarea id="new-post-text" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?"></textarea>
                    <button class="action-btn" onclick="app.createPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
                </div>
                <h2>–í—Å–µ –ø–æ—Å—Ç—ã</h2>
                <div id="feed-container"></div>
            </div>

            <div id="view-profile" class="view">
                <div id="profile-content"></div>
                <h3>–ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <div id="profile-posts"></div>
            </div>

            <div id="view-chats" class="view">
                <h2>–í–∞—à–∏ –¥—Ä—É–∑—å—è</h2>
                <p style="font-size: 0.9em; color: gray;">–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —á–∞—Ç, –≤—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∑–∞–∏–º–Ω–æ –ø–æ–¥–ø–∏—Å–∞–Ω—ã.</p>
                <div id="friends-list"></div>
            </div>

            <div id="view-chat-room" class="view" style="padding: 0; display: none; flex-direction: column;">
                <div style="padding: 15px; border-bottom: 1px solid var(--border-color); background: var(--secondary-bg);">
                    <button onclick="ui.navigate('chats')" style="width: auto; padding: 5px 10px; margin-right: 10px;">‚Üê –ù–∞–∑–∞–¥</button>
                    <b id="chat-with-name">User</b>
                </div>
                <div class="messages-area" id="messages-container"></div>
                <div class="chat-input-area">
                    <input type="text" id="message-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="margin:0;">
                    <button onclick="app.sendMessage()" style="width: auto; margin:0;">Send</button>
                </div>
            </div>

            <div id="view-settings" class="view">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <div style="margin-top: 20px;">
                    <label>
                        <input type="checkbox" id="theme-toggle" onchange="ui.toggleTheme()"> –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
                    </label>
                </div>
            </div>

        </div>
    </div>

<script>
/* --- DATABASE SIMULATION (LocalStorage) --- */
const db = {
    getUsers: () => JSON.parse(localStorage.getItem('users')) || [],
    saveUsers: (users) => localStorage.setItem('users', JSON.stringify(users)),
    
    getPosts: () => JSON.parse(localStorage.getItem('posts')) || [],
    savePosts: (posts) => localStorage.setItem('posts', JSON.stringify(posts)),

    getChats: () => JSON.parse(localStorage.getItem('chats')) || {},
    saveChats: (chats) => localStorage.setItem('chats', JSON.stringify(chats)),

    getCurrentUser: () => localStorage.getItem('currentUser'),
    setCurrentUser: (username) => localStorage.setItem('currentUser', username),

    findUser: (username) => db.getUsers().find(u => u.username === username),
    updateUser: (updatedUser) => {
        let users = db.getUsers();
        const index = users.findIndex(u => u.username === updatedUser.username);
        if(index !== -1) {
            users[index] = updatedUser;
            db.saveUsers(users);
        }
    }
};

/* --- APPLICATION LOGIC --- */
const app = {
    currentUser: null,
    activeChatPartner: null,

    init: () => {
        app.currentUser = db.getCurrentUser();
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('theme-toggle').checked = true;
        }

        if (app.currentUser) {
            ui.showApp();
        } else {
            ui.showAuth();
        }
    },

    register: () => {
        const userIn = document.getElementById('reg-username').value.trim();
        const passIn = document.getElementById('reg-password').value.trim();

        if (!userIn || !passIn) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
        if (db.findUser(userIn)) return alert('–Æ–∑–µ—Ä–Ω–µ–π–º –∑–∞–Ω—è—Ç');

        const newUser = {
            username: userIn,
            password: passIn,
            followers: [], // array of usernames
            following: [], // array of usernames
            joined: new Date().toLocaleDateString()
        };

        const users = db.getUsers();
        users.push(newUser);
        db.saveUsers(users);
        
        alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.');
        ui.toggleAuth('login');
    },

    login: () => {
        const userIn = document.getElementById('login-username').value.trim();
        const passIn = document.getElementById('login-password').value.trim();
        
        const user = db.findUser(userIn);
        if (user && user.password === passIn) {
            db.setCurrentUser(userIn);
            app.currentUser = userIn;
            ui.showApp();
            location.reload(); // Refresh to load data
        } else {
            alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
        }
    },

    logout: () => {
        localStorage.removeItem('currentUser');
        location.reload();
    },

    createPost: () => {
        const text = document.getElementById('new-post-text').value.trim();
        if (!text) return;

        const posts = db.getPosts();
        posts.unshift({
            id: Date.now(),
            author: app.currentUser,
            content: text,
            date: new Date().toLocaleString()
        });
        db.savePosts(posts);
        
        document.getElementById('new-post-text').value = '';
        ui.renderFeed();
    },

    follow: (targetUsername) => {
        if (targetUsername === app.currentUser) return;
        
        let me = db.findUser(app.currentUser);
        let target = db.findUser(targetUsername);

        if (!me.following.includes(targetUsername)) {
            me.following.push(targetUsername);
            target.followers.push(app.currentUser);
        } else {
            // Unfollow logic
            me.following = me.following.filter(u => u !== targetUsername);
            target.followers = target.followers.filter(u => u !== app.currentUser);
        }

        db.updateUser(me);
        db.updateUser(target);
        ui.renderProfile(targetUsername); // Re-render to update button
    },

    sendMessage: () => {
        const text = document.getElementById('message-input').value.trim();
        if (!text || !app.activeChatPartner) return;

        const chatId = [app.currentUser, app.activeChatPartner].sort().join('_');
        const chats = db.getChats();
        
        if (!chats[chatId]) chats[chatId] = [];
        
        chats[chatId].push({
            sender: app.currentUser,
            text: text,
            timestamp: Date.now()
        });

        db.saveChats(chats);
        document.getElementById('message-input').value = '';
        ui.renderChatRoom(app.activeChatPartner);
    }
};

/* --- UI HANDLING --- */
const ui = {
    toggleAuth: (mode) => {
        document.getElementById('login-box').classList.toggle('hidden', mode !== 'login');
        document.getElementById('register-box').classList.toggle('hidden', mode !== 'register');
    },

    showAuth: () => {
        document.getElementById('auth-screen').style.display = 'flex';
        document.getElementById('app-screen').style.display = 'none';
    },

    showApp: () => {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('app-screen').style.display = 'flex';
        ui.navigate('feed');
    },

    navigate: (viewName, param = null) => {
        // Hide all views
        document.querySelectorAll('.view').forEach(el => {
            el.classList.remove('active');
            if(el.id === 'view-chat-room') el.style.display = 'none';
        });
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

        // Handle specific views
        if (viewName === 'feed') {
            document.getElementById('view-feed').classList.add('active');
            ui.renderFeed();
        } else if (viewName === 'profile') {
            document.getElementById('view-profile').classList.add('active');
            ui.renderProfile(param || app.currentUser);
        } else if (viewName === 'chats') {
            document.getElementById('view-chats').classList.add('active');
            ui.renderChatsList();
        } else if (viewName === 'chat-room') {
            const room = document.getElementById('view-chat-room');
            room.classList.add('active');
            room.style.display = 'flex'; // override flex for chat layout
            app.activeChatPartner = param;
            ui.renderChatRoom(param);
        } else if (viewName === 'settings') {
            document.getElementById('view-settings').classList.add('active');
        }
    },

    renderFeed: () => {
        const container = document.getElementById('feed-container');
        container.innerHTML = '';
        const posts = db.getPosts();
        
        posts.forEach(post => {
            const div = document.createElement('div');
            div.className = 'post-card';
            div.innerHTML = `
                <div class="post-header" onclick="ui.navigate('profile', '${post.author}')">@${post.author}</div>
                <div class="post-content">${post.content}</div>
                <div class="post-date">${post.date}</div>
            `;
            container.appendChild(div);
        });
    },

    renderProfile: (username) => {
        const user = db.findUser(username);
        const container = document.getElementById('profile-content');
        const postsContainer = document.getElementById('profile-posts');
        
        if (!user) {
            container.innerHTML = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
            return;
        }

        const isMe = username === app.currentUser;
        const isFollowing = db.findUser(app.currentUser).following.includes(username);
        
        // Check mutual follow for "Write Message"
        const isFriend = user.following.includes(app.currentUser) && user.followers.includes(app.currentUser);

        let actionButton = '';
        if (!isMe) {
            actionButton = `<button class="action-btn" onclick="app.follow('${username}')">
                ${isFollowing ? '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è' : '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è'}
            </button>`;
            
            if (isFriend) {
                actionButton += `<button class="action-btn" style="margin-left:10px; background:#4caf50;" onclick="ui.navigate('chat-room', '${username}')">–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>`;
            }
        }

        container.innerHTML = `
            <h2>@${user.username}</h2>
            <div class="profile-stats">
                <span>${user.followers.length} –ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</span>
                <span>${user.following.length} –ü–æ–¥–ø–∏—Å–æ–∫</span>
            </div>
            ${actionButton}
        `;

        // Render user specific posts
        postsContainer.innerHTML = '';
        const allPosts = db.getPosts();
        const userPosts = allPosts.filter(p => p.author === username);
        
        if (userPosts.length === 0) postsContainer.innerHTML = '<p>–ù–µ—Ç –ø–æ—Å—Ç–æ–≤</p>';

        userPosts.forEach(post => {
            const div = document.createElement('div');
            div.className = 'post-card';
            div.innerHTML = `
                <div class="post-header">@${post.author}</div>
                <div class="post-content">${post.content}</div>
                <div class="post-date">${post.date}</div>
            `;
            postsContainer.appendChild(div);
        });
    },

    renderChatsList: () => {
        const container = document.getElementById('friends-list');
        container.innerHTML = '';
        
        const me = db.findUser(app.currentUser);
        // Find mutual followers (friends)
        const friends = me.following.filter(u => {
            const friendUser = db.findUser(u);
            return friendUser.following.includes(app.currentUser);
        });

        if (friends.length === 0) {
            container.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π (–≤–∑–∞–∏–º–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫).</p>';
            return;
        }

        friends.forEach(friendName => {
            const div = document.createElement('div');
            div.className = 'user-item';
            div.innerHTML = `<b>@${friendName}</b> <span>–ù–∞–ø–∏—Å–∞—Ç—å ‚ûú</span>`;
            div.onclick = () => ui.navigate('chat-room', friendName);
            container.appendChild(div);
        });
    },

    renderChatRoom: (partner) => {
        document.getElementById('chat-with-name').innerText = '@' + partner;
        const container = document.getElementById('messages-container');
        
        const chatId = [app.currentUser, partner].sort().join('_');
        const chats = db.getChats();
        const messages = chats[chatId] || [];

        container.innerHTML = '';
        messages.forEach(msg => {
            const div = document.createElement('div');
            const isOwn = msg.sender === app.currentUser;
            div.className = `message-bubble ${isOwn ? 'msg-own' : 'msg-other'}`;
            div.innerText = msg.text;
            container.appendChild(div);
        });
        
        // Scroll to bottom
        container.scrollTop = container.scrollHeight;
    },

    toggleTheme: () => {
        const isDark = document.getElementById('theme-toggle').checked;
        if (isDark) {
            document.documentElement.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
        } else {
            document.documentElement.removeAttribute('data-theme');
            localStorage.setItem('theme', 'light');
        }
    }
};

// Start
app.init();
</script>
</body>
</html>
